<dom-module id="confsave-tabs">
  <style>
    .configurator-container {
      width:1000px;
      margin:auto;
      padding: 50px;
    }

    paper-tabs {
      height:100px;
    }
  </style>
  <template>
    <h1>Seating configurator</h1>
    <paper-tabs selected="{{selected}}">
      <template is="dom-repeat" items="{{configurations}}">
        <paper-tab><confsave-tab configuration="{{item}}"></confsave-tab></paper-tab>
      </template>
      <paper-tab on-tap="_newTab"><confsave-tab></confsave-tab></paper-tab>
    </paper-tabs>
    <paper-header-panel>
      <paper-toolbar>
      </paper-toolbar>
      <iron-pages selected="{{selected}}">
        <template is="dom-repeat" items="{{configurations}}">
          <div class="configurator-container"><asi-configurator base-api-url="http://skuapp.azurewebsites.net/" sku="{{item.sku}}"></asi-configurator-product></div>
        </template>
        <div>Click the tab header to add a new configuration.</div>
      </iron-pages>
    </paper-header-panel>

  </template>
</dom-module>
<script>
  Polymer({
    is: "confsave-tabs",
    properties: {
      selected: {
        type: Number,
        value: 0
      },
      configurations: {
        type: Array,
        value: []
      }
    },
    _newTab: function() {
      this.push("configurations", {
        id: this._guid(),
        name: "#19 in Silver with CU",
        sku: "A19-HWS.2.PR6.CU42"
      });
      this.selected = this.configurations.length - 2;
    },
    _guid() {
      function s4() {
        return Math.floor((1 + Math.random()) * 0x10000)
          .toString(16)
          .substring(1);
      }
      return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
        s4() + '-' + s4() + s4() + s4();
    },
    listeners: {
      "confsave-close-tab": "_closeTab"
    },
    _closeTab: function(e) {
      var id = e.detail;
      var index = 0;
      this.configurations.forEach(function(item, i) {
        if(item.id == id) {
          index = i;
        }
      });
      this.pop("configurations", index);
    }
  });
</script>
